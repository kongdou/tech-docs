# OSI模型

![OSI](https://github.com/kongdou/tech-docs/blob/master/images/OSI.png)

## OSI七层模型
### 物理层

物理层是实际信号的传输，通过物理介质传输比特流。规定了**电平**、**速度**和**电缆针脚**

### 数据链路层
将比特组合成字节，再将字节组合成帧

采用差错检测、差错控制和流量控制等方法，向网络层提供高质量的数据传输服务

**数据链路层的信道类型:**  
- 点到点信道：这种信道使用一对一的点对点通信方式
- 广播信道：广播信道上的主机很多，需要专用的共享信道协议来协调主机的数据发送。

**数据链路层解决的问题:**  
**（1）封装成帧**  
在一段数据（IP数据报）前后分别添加首部和尾部，然后就构成了一个帧。  
![zhen](https://github.com/kongdou/tech-docs/blob/master/images/zhen.png)

**（2）透明传输**  
透明传输是指不管所传数据是什么样的比特组合，都应当能够在链路上传送。当所传数据中的比特组合恰巧与某一个控制信息完全一样时，就必须采取适当的措施，使接收方不会将这样的数据误认为是某种控制信息。  
![zhen-eot](https://github.com/kongdou/tech-docs/blob/master/images/zhen-eot.png)

<span id="byte-s">
解决方式：字符填充  
字节填充(byte stuffing)或字符填充(character stuffing)，发送端在发送数据前，将数据中的控制信息前插入一个转义字符（ESC），接收端的数据链路层在将数据送往网络层之前删除插入的转义字符。如果转义字符（ESC）也出现数据当中，那么应在转义字符前面插入一个转义字符。当接收端收到连续的两个转义字符时，就删除其中前面的一个。  
![byte-stuffing](https://github.com/kongdou/tech-docs/blob/master/images/byte-stuffing.png)
</span>

**（3）差错校验**  
在传输过程中可能会产生比特差错：1 可能会变成 0 而 0 也可能变成 1。在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率 BER 。为了保证数据传输的可靠性，必须采用各种差错检测措施。  

解决方式：循环冗余校验码（CRC）  
循环冗余检验 CRC只是实现了差错检验，并不纠正错误

CRC详见：
https://github.com/kongdou/tech-docs/blob/master/基础/循环冗余校验码.md







### 网络层
### 传输层
### 会话层
### 连接层
### 应用层

## TCP/IP五层模型

## 设备
### 物理层
物理层常用的设备有**集线器**、**中继器**、**调制解调器**、**网线**、**双绞线**、**同轴电缆**，这些均为传输介质。

> 中继器（RP repeater）工作于OSI的物理层，是局域网上所有节点的中心，它的作用是放大信号，补偿信号衰减，支持远距离的通信。

> 集线器（Hub）是指将多条以太网双绞线或光纤集合连接在同一段物理介质下的设备。集线器是运作在OSI模型中的物理层。它可以视作多端口的中继器，若它侦测到碰撞，它会提交阻塞信号

> 集线器和中继器的区别是：中继器只有两个以太网接口，而集线器相当于多个端口的中继器。


## 协议
### 数据链路层
#### PPP协议
现在全世界使用得最多的数据链路层协议是点对点协议 PPP，PPP 协议有三个组成部分：
- 一个将 IP 数据报封装到串行链路的方法
- 链路控制协议LCP (Link Control Protocol)
- 网络控制协议NCP（NetWork Control Protocol）

#### PPP协议的工作状态

![ppp-work-state](https://github.com/kongdou/tech-docs/blob/master/images/ppp-work-state.png)

PPP通讯是两个端点之间的通讯，每一端必须首先发送LCP packets数据来设定和测试数据链路，当链路建立后，peer才可以被认证，认证完成后，再通过发送NCP packets来选定网络层协议，这些后续的通讯就可以在网络层进行了。

**帧格式：**  
![ppp-zhen](https://github.com/kongdou/tech-docs/blob/master/images/ppp-zhen.png)

（1）标志字段F，固定为0x7E，标志一个帧的开始或结束。连续2个帧之间只需要一个标志字段，如果出现连续两个标志字段，表示这是一个空帧。

（2）地址字段A是固定不变的，为0xFF

（3）控制字段C是固定不变的，为0x03

（4）PPP是面向字节的，所有的PPP帧的长度都是整数字节

（5）协议字段不同，后面信息部分表示的数据类型不同：
- 0x0021——信息字段是IP数据报
- 0xC021——信息字段是链路控制数据LCP
- 0x8021——信息字段是网络控制数据NCP
- 0xC023——信息字段是安全性认证PAP
- 0xC025——信息字段是LQR
- 0xC223——信息字段是安全性认证CHAP

**透明传输问题：**

（1）字符填充（详见[byte-s](#byte-s)）

（2）零比特填充  
发送端，只要发现5个连续1，则立即填入一个 0（如果6个连续1就和首位标志字段冲突），接收端对帧中的比特流进行扫描。每当发现 5 个连续1时，就把这 5 个连续 1 后的一个 0 删除

![0-byte](https://github.com/kongdou/tech-docs/blob/master/images/0-byte.png)
